ðŸ§ª Running Logprobs Integration Tests
==================================================

ðŸ“‹ Running Generate API (with logprobs) test...
Testing Generate API with logprobs via options...
Request: {
  "model": "qwen2.5:0.5b",
  "prompt": "Say hello",
  "stream": false,
  "options": {
    "logprobs": true,
    "top_logprobs": 3
  }
}
Response: {
  "model": "qwen2.5:0.5b",
  "created_at": "2025-09-16T00:34:24.127864396Z",
  "response": "Hello! How can I help you today? If there's anything specific or urgent that needs attention, feel free to let me know and we'll discuss it together. Goodbye!",
  "done": true,
  "done_reason": "stop",
  "context": [
    151644,
    8948,
    198,
    2610,
    525,
    1207,
    16948,
    11,
    3465,
    553,
    54364,
    14817,
    13,
    1446,
    525,
    264,
    10950,
    17847,
    13,
    151645,
    198,
    151644,
    872,
    198,
    45764,
    23811,
    151645,
    198,
    151644,
    77091,
    198,
    9707,
    0,
    2585,
    646,
    358,
    1492,
    498,
    3351,
    30,
    1416,
    1052,
    594,
    4113,
    3151,
    476,
    33671,
    429,
    3880,
    6529,
    11,
    2666,
    1910,
    311,
    1077,
    752,
    1414,
    323,
    582,
    3278,
    4263,
    432,
    3786,
    13,
    7684,
    28374,
    0
  ],
  "total_duration": 7758924363,
  "load_duration": 851752445,
  "prompt_eval_count": 31,
  "prompt_eval_duration": 2401422819,
  "eval_count": 37,
  "eval_duration": 4504612459,
  "logprobs": [
    {
      "token": "Hello",
      "logprob": -0.0234361093949319,
      "bytes": [
        72,
        101,
        108,
        108,
        111
      ],
      "top_logprobs": [
        {
          "token": "Hello",
          "logprob": -0.023436108604073524,
          "bytes": [
            72,
            101,
            108,
            108,
            111
          ]
        },
        {
          "token": "\u4f60\u597d",
          "logprob": -4.2192463874816895,
          "bytes": [
            228,
            189,
            160,
            229,
            165,
            189
          ]
        },
        {
          "token": "Hi",
          "logprob": -5.994608402252197,
          "bytes": [
            72,
            105
          ]
        }
      ]
    },
    {
      "token": "!",
      "logprob": -0.0165395838052924,
      "bytes": [
        33
      ],
      "top_logprobs": [
        {
          "token": "!",
          "logprob": -0.01653958298265934,
          "bytes": [
            33
          ]
        },
        {
          "token": " there",
          "logprob": -4.913653373718262,
          "bytes": [
            32,
            116,
            104,
            101,
            114,
            101
          ]
        },
        {
          "token": ",",
          "logprob": -4.928025245666504,
          "bytes": [
            44
          ]
        }
      ]
    },
    {
      "token": " How",
      "logprob": -0.37946460182201597,
      "bytes": [
        32,
        72,
        111,
        119
      ],
      "top_logprobs": [
        {
          "token": " How",
          "logprob": -0.37946459650993347,
          "bytes": [
            32,
            72,
            111,
            119
          ]
        },
        {
          "token": " It",
          "logprob": -1.4281134605407715,
          "bytes": [
            32,
            73,
            116
          ]
        },
        {
          "token": " I",
          "logprob": -3.4592013359069824,
          "bytes": [
            32,
            73
          ]
        }
      ]
    },
    {
      "token": " can",
      "logprob": -0.08392213070415744,
      "bytes": [
        32,
        99,
        97,
        110
      ],
      "top_logprobs": [
        {
          "token": " can",
          "logprob": -0.0839221328496933,
          "bytes": [
            32,
            99,
            97,
            110
          ]
        },
        {
          "token": " may",
          "logprob": -2.5336921215057373,
          "bytes": [
            32,
            109,
            97,
            121
          ]
        },
        {
          "token": " are",
          "logprob": -8.157892227172852,
          "bytes": [
            32,
            97,
            114,
            101
          ]
        }
      ]
    },
    {
      "token": " I",
      "logprob": -8.106560262170838e-05,
      "bytes": [
        32,
        73
      ],
      "top_logprobs": [
        {
          "token": " I",
          "logprob": -8.106560562737286e-05,
          "bytes": [
            32,
            73
          ]
        },
        {
          "token": " assistance",
          "logprob": -10.0459566116333,
          "bytes": [
            32,
            97,
            115,
            115,
            105,
            115,
            116,
            97,
            110,
            99,
            101
          ]
        },
        {
          "token": " ",
          "logprob": -11.515618324279785,
          "bytes": [
            32
          ]
        }
      ]
    },
    {
      "token": " help",
      "logprob": -0.8618860217506565,
      "bytes": [
        32,
        104,
        101,
        108,
        112
      ],
      "top_logprobs": [
        {
          "token": " assist",
          "logprob": -0.5538282990455627,
          "bytes": [
            32,
            97,
            115,
            115,
            105,
            115,
            116
          ]
        },
        {
          "token": " help",
          "logprob": -0.8618860244750977,
          "bytes": [
            32,
            104,
            101,
            108,
            112
          ]
        },
        {
          "token": " be",
          "logprob": -6.0449018478393555,
          "bytes": [
            32,
            98,
            101
          ]
        }
      ]
    },
    {
      "token": " you",
      "logprob": -0.00045578136185415053,
      "bytes": [
        32,
        121,
        111,
        117
      ],
      "top_logprobs": [
        {
          "token": " you",
          "logprob": -0.00045578135177493095,
          "bytes": [
            32,
            121,
            111,
            117
          ]
        },
        {
          "token": "?",
          "logprob": -8.119792938232422,
          "bytes": [
            63
          ]
        },
        {
          "token": " with",
          "logprob": -9.89405632019043,
          "bytes": [
            32,
            119,
            105,
            116,
            104
          ]
        }
      ]
    },
    {
      "token": " today",
      "logprob": -0.00453832830496936,
      "bytes": [
        32,
        116,
        111,
        100,
        97,
        121
      ],
      "top_logprobs": [
        {
          "token": " today",
          "logprob": -0.0045383283868432045,
          "bytes": [
            32,
            116,
            111,
            100,
            97,
            121
          ]
        },
        {
          "token": " with",
          "logprob": -6.204543113708496,
          "bytes": [
            32,
            119,
            105,
            116,
            104
          ]
        },
        {
          "token": "?",
          "logprob": -6.257489204406738,
          "bytes": [
            63
          ]
        }
      ]
    },
    {
      "token": "?",
      "logprob": -0.0017144467104345392,
      "bytes": [
        63
      ],
      "top_logprobs": [
        {
          "token": "?",
          "logprob": -0.0017144466983154416,
          "bytes": [
            63
          ]
        },
        {
          "token": "?\n",
          "logprob": -7.479772090911865,
          "bytes": [
            63,
            10
          ]
        },
        {
          "token": " with",
          "logprob": -7.493602275848389,
          "bytes": [
            32,
            119,
            105,
            116,
            104
          ]
        }
      ]
    },
    {
      "token": " If",
      "logprob": -3.266071211035388,
      "bytes": [
        32,
        73,
        102
      ],
      "top_logprobs": [
        {
          "token": "<|im_end|>",
          "logprob": -0.1462954878807068,
          "bytes": [
            60,
            124,
            105,
            109,
            95,
            101,
            110,
            100,
            124,
            62
          ]
        },
        {
          "token": " If",
          "logprob": -3.266071319580078,
          "bytes": [
            32,
            73,
            102
          ]
        },
        {
          "token": " Is",
          "logprob": -3.7665700912475586,
          "bytes": [
            32,
            73,
            115
          ]
        }
      ]
    },
    {
      "token": " there",
      "logprob": -3.1888587711043748,
      "bytes": [
        32,
        116,
        104,
        101,
        114,
        101
      ],
      "top_logprobs": [
        {
          "token": " you",
          "logprob": -0.042959947139024734,
          "bytes": [
            32,
            121,
            111,
            117
          ]
        },
        {
          "token": " there",
          "logprob": -3.1888587474823,
          "bytes": [
            32,
            116,
            104,
            101,
            114,
            101
          ]
        },
        {
          "token": " I",
          "logprob": -7.287563800811768,
          "bytes": [
            32,
            73
          ]
        }
      ]
    },
    {
      "token": "'s",
      "logprob": -0.053670402617760606,
      "bytes": [
        39,
        115
      ],
      "top_logprobs": [
        {
          "token": "'s",
          "logprob": -0.053670402616262436,
          "bytes": [
            39,
            115
          ]
        },
        {
          "token": " is",
          "logprob": -3.344247341156006,
          "bytes": [
            32,
            105,
            115
          ]
        },
        {
          "token": " are",
          "logprob": -4.7867655754089355,
          "bytes": [
            32,
            97,
            114,
            101
          ]
        }
      ]
    },
    {
      "token": " anything",
      "logprob": -0.08588799466593504,
      "bytes": [
        32,
        97,
        110,
        121,
        116,
        104,
        105,
        110,
        103
      ],
      "top_logprobs": [
        {
          "token": " anything",
          "logprob": -0.08588799834251404,
          "bytes": [
            32,
            97,
            110,
            121,
            116,
            104,
            105,
            110,
            103
          ]
        },
        {
          "token": " something",
          "logprob": -2.5430068969726562,
          "bytes": [
            32,
            115,
            111,
            109,
            101,
            116,
            104,
            105,
            110,
            103
          ]
        },
        {
          "token": " any",
          "logprob": -6.299835205078125,
          "bytes": [
            32,
            97,
            110,
            121
          ]
        }
      ]
    },
    {
      "token": " specific",
      "logprob": -0.5166994542998562,
      "bytes": [
        32,
        115,
        112,
        101,
        99,
        105,
        102,
        105,
        99
      ],
      "top_logprobs": [
        {
          "token": " specific",
          "logprob": -0.5166994333267212,
          "bytes": [
            32,
            115,
            112,
            101,
            99,
            105,
            102,
            105,
            99
          ]
        },
        {
          "token": " I",
          "logprob": -1.4262853860855103,
          "bytes": [
            32,
            73
          ]
        },
        {
          "token": " you",
          "logprob": -2.0523648262023926,
          "bytes": [
            32,
            121,
            111,
            117
          ]
        }
      ]
    },
    {
      "token": " or",
      "logprob": -2.773906912925676,
      "bytes": [
        32,
        111,
        114
      ],
      "top_logprobs": [
        {
          "token": " you",
          "logprob": -0.13777565956115723,
          "bytes": [
            32,
            121,
            111,
            117
          ]
        },
        {
          "token": " or",
          "logprob": -2.773906946182251,
          "bytes": [
            32,
            111,
            114
          ]
        },
        {
          "token": " I",
          "logprob": -3.4717485904693604,
          "bytes": [
            32,
            73
          ]
        }
      ]
    },
    {
      "token": " urgent",
      "logprob": -0.9275335004151746,
      "bytes": [
        32,
        117,
        114,
        103,
        101,
        110,
        116
      ],
      "top_logprobs": [
        {
          "token": " urgent",
          "logprob": -0.9275335073471069,
          "bytes": [
            32,
            117,
            114,
            103,
            101,
            110,
            116
          ]
        },
        {
          "token": " you",
          "logprob": -1.678641676902771,
          "bytes": [
            32,
            121,
            111,
            117
          ]
        },
        {
          "token": " interesting",
          "logprob": -2.439053773880005,
          "bytes": [
            32,
            105,
            110,
            116,
            101,
            114,
            101,
            115,
            116,
            105,
            110,
            103
          ]
        }
      ]
    },
    {
      "token": " that",
      "logprob": -1.3360146684793928,
      "bytes": [
        32,
        116,
        104,
        97,
        116
      ],
      "top_logprobs": [
        {
          "token": " you",
          "logprob": -0.47383394837379456,
          "bytes": [
            32,
            121,
            111,
            117
          ]
        },
        {
          "token": " that",
          "logprob": -1.3360146284103394,
          "bytes": [
            32,
            116,
            104,
            97,
            116
          ]
        },
        {
          "token": " I",
          "logprob": -3.436579704284668,
          "bytes": [
            32,
            73
          ]
        }
      ]
    },
    {
      "token": " needs",
      "logprob": -1.841984040125129,
      "bytes": [
        32,
        110,
        101,
        101,
        100,
        115
      ],
      "top_logprobs": [
        {
          "token": " you",
          "logprob": -0.6936914324760437,
          "bytes": [
            32,
            121,
            111,
            117
          ]
        },
        {
          "token": " I",
          "logprob": -1.2308886051177979,
          "bytes": [
            32,
            73
          ]
        },
        {
          "token": " needs",
          "logprob": -1.8419840335845947,
          "bytes": [
            32,
            110,
            101,
            101,
            100,
            115
          ]
        }
      ]
    },
    {
      "token": " attention",
      "logprob": -1.7954209123387492,
      "bytes": [
        32,
        97,
        116,
        116,
        101,
        110,
        116,
        105,
        111,
        110
      ],
      "top_logprobs": [
        {
          "token": " assistance",
          "logprob": -0.7939561009407043,
          "bytes": [
            32,
            97,
            115,
            115,
            105,
            115,
            116,
            97,
            110,
            99,
            101
          ]
        },
        {
          "token": " attention",
          "logprob": -1.7954208850860596,
          "bytes": [
            32,
            97,
            116,
            116,
            101,
            110,
            116,
            105,
            111,
            110
          ]
        },
        {
          "token": " to",
          "logprob": -2.23003888130188,
          "bytes": [
            32,
            116,
            111
          ]
        }
      ]
    },
    {
      "token": ",",
      "logprob": -0.056200248019387826,
      "bytes": [
        44
      ],
      "top_logprobs": [
        {
          "token": ",",
          "logprob": -0.05620024725794792,
          "bytes": [
            44
          ]
        },
        {
          "token": " or",
          "logprob": -3.1260435581207275,
          "bytes": [
            32,
            111,
            114
          ]
        },
        {
          "token": " that",
          "logprob": -6.095911502838135,
          "bytes": [
            32,
            116,
            104,
            97,
            116
          ]
        }
      ]
    },
    {
      "token": " feel",
      "logprob": -0.7629911171351536,
      "bytes": [
        32,
        102,
        101,
        101,
        108
      ],
      "top_logprobs": [
        {
          "token": " feel",
          "logprob": -0.7629911303520203,
          "bytes": [
            32,
            102,
            101,
            101,
            108
          ]
        },
        {
          "token": " please",
          "logprob": -1.0455381870269775,
          "bytes": [
            32,
            112,
            108,
            101,
            97,
            115,
            101
          ]
        },
        {
          "token": " I",
          "logprob": -2.5077993869781494,
          "bytes": [
            32,
            73
          ]
        }
      ]
    },
    {
      "token": " free",
      "logprob": -9.537197940327512e-05,
      "bytes": [
        32,
        102,
        114,
        101,
        101
      ],
      "top_logprobs": [
        {
          "token": " free",
          "logprob": -9.537197911413386e-05,
          "bytes": [
            32,
            102,
            114,
            101,
            101
          ]
        },
        {
          "token": " comfortable",
          "logprob": -10.111461639404297,
          "bytes": [
            32,
            99,
            111,
            109,
            102,
            111,
            114,
            116,
            97,
            98,
            108,
            101
          ]
        },
        {
          "token": " Free",
          "logprob": -11.234479904174805,
          "bytes": [
            32,
            70,
            114,
            101,
            101
          ]
        }
      ]
    },
    {
      "token": " to",
      "logprob": -8.344653750216029e-07,
      "bytes": [
        32,
        116,
        111
      ],
      "top_logprobs": [
        {
          "token": " to",
          "logprob": -8.344653679159819e-07,
          "bytes": [
            32,
            116,
            111
          ]
        },
        {
          "token": "!",
          "logprob": -14.490675926208496,
          "bytes": [
            33
          ]
        },
        {
          "token": "\u6765\u8bf4",
          "logprob": -15.625126838684082,
          "bytes": [
            230,
            157,
            165,
            232,
            175,
            180
          ]
        }
      ]
    },
    {
      "token": " let",
      "logprob": -0.43138413168435874,
      "bytes": [
        32,
        108,
        101,
        116
      ],
      "top_logprobs": [
        {
          "token": " let",
          "logprob": -0.4313841462135315,
          "bytes": [
            32,
            108,
            101,
            116
          ]
        },
        {
          "token": " ask",
          "logprob": -1.5221986770629883,
          "bytes": [
            32,
            97,
            115,
            107
          ]
        },
        {
          "token": " share",
          "logprob": -2.4630022048950195,
          "bytes": [
            32,
            115,
            104,
            97,
            114,
            101
          ]
        }
      ]
    },
    {
      "token": " me",
      "logprob": -1.2397842966218753e-05,
      "bytes": [
        32,
        109,
        101
      ],
      "top_logprobs": [
        {
          "token": " me",
          "logprob": -1.23978434203309e-05,
          "bytes": [
            32,
            109,
            101
          ]
        },
        {
          "token": " us",
          "logprob": -12.199437141418457,
          "bytes": [
            32,
            117,
            115
          ]
        },
        {
          "token": " the",
          "logprob": -12.33726978302002,
          "bytes": [
            32,
            116,
            104,
            101
          ]
        }
      ]
    },
    {
      "token": " know",
      "logprob": -0.00012088552596527209,
      "bytes": [
        32,
        107,
        110,
        111,
        119
      ],
      "top_logprobs": [
        {
          "token": " know",
          "logprob": -0.00012088552466593683,
          "bytes": [
            32,
            107,
            110,
            111,
            119
          ]
        },
        {
          "token": " be",
          "logprob": -10.85229206085205,
          "bytes": [
            32,
            98,
            101
          ]
        },
        {
          "token": " handle",
          "logprob": -11.147208213806152,
          "bytes": [
            32,
            104,
            97,
            110,
            100,
            108,
            101
          ]
        }
      ]
    },
    {
      "token": " and",
      "logprob": -0.9751676893813911,
      "bytes": [
        32,
        97,
        110,
        100
      ],
      "top_logprobs": [
        {
          "token": " and",
          "logprob": -0.9751676917076111,
          "bytes": [
            32,
            97,
            110,
            100
          ]
        },
        {
          "token": ",",
          "logprob": -1.1904882192611694,
          "bytes": [
            44
          ]
        },
        {
          "token": ".",
          "logprob": -1.5014070272445679,
          "bytes": [
            46
          ]
        }
      ]
    },
    {
      "token": " we",
      "logprob": -2.7250771170103296,
      "bytes": [
        32,
        119,
        101
      ],
      "top_logprobs": [
        {
          "token": " I",
          "logprob": -0.07210023701190948,
          "bytes": [
            32,
            73
          ]
        },
        {
          "token": " we",
          "logprob": -2.7250771522521973,
          "bytes": [
            32,
            119,
            101
          ]
        },
        {
          "token": " let",
          "logprob": -6.766394138336182,
          "bytes": [
            32,
            108,
            101,
            116
          ]
        }
      ]
    },
    {
      "token": "'ll",
      "logprob": -1.8757675909222702,
      "bytes": [
        39,
        108,
        108
      ],
      "top_logprobs": [
        {
          "token": " can",
          "logprob": -0.1693066656589508,
          "bytes": [
            32,
            99,
            97,
            110
          ]
        },
        {
          "token": "'ll",
          "logprob": -1.8757675886154175,
          "bytes": [
            39,
            108,
            108
          ]
        },
        {
          "token": " will",
          "logprob": -6.818764686584473,
          "bytes": [
            32,
            119,
            105,
            108,
            108
          ]
        }
      ]
    },
    {
      "token": " discuss",
      "logprob": -1.5032837704619753,
      "bytes": [
        32,
        100,
        105,
        115,
        99,
        117,
        115,
        115
      ],
      "top_logprobs": [
        {
          "token": " get",
          "logprob": -1.4284451007843018,
          "bytes": [
            32,
            103,
            101,
            116
          ]
        },
        {
          "token": " work",
          "logprob": -1.453788161277771,
          "bytes": [
            32,
            119,
            111,
            114,
            107
          ]
        },
        {
          "token": " discuss",
          "logprob": -1.5032837390899658,
          "bytes": [
            32,
            100,
            105,
            115,
            99,
            117,
            115,
            115
          ]
        }
      ]
    },
    {
      "token": " it",
      "logprob": -3.344623100000219,
      "bytes": [
        32,
        105,
        116
      ],
      "top_logprobs": [
        {
          "token": " the",
          "logprob": -0.8145975470542908,
          "bytes": [
            32,
            116,
            104,
            101
          ]
        },
        {
          "token": " how",
          "logprob": -1.4592509269714355,
          "bytes": [
            32,
            104,
            111,
            119
          ]
        },
        {
          "token": " a",
          "logprob": -2.1631808280944824,
          "bytes": [
            32,
            97
          ]
        }
      ]
    },
    {
      "token": " together",
      "logprob": -0.31485859815056083,
      "bytes": [
        32,
        116,
        111,
        103,
        101,
        116,
        104,
        101,
        114
      ],
      "top_logprobs": [
        {
          "token": " together",
          "logprob": -0.3148585855960846,
          "bytes": [
            32,
            116,
            111,
            103,
            101,
            116,
            104,
            101,
            114
          ]
        },
        {
          "token": " further",
          "logprob": -2.3484394550323486,
          "bytes": [
            32,
            102,
            117,
            114,
            116,
            104,
            101,
            114
          ]
        },
        {
          "token": ".",
          "logprob": -2.4307644367218018,
          "bytes": [
            46
          ]
        }
      ]
    },
    {
      "token": ".",
      "logprob": -0.012889667994853733,
      "bytes": [
        46
      ],
      "top_logprobs": [
        {
          "token": ".",
          "logprob": -0.012889668345451355,
          "bytes": [
            46
          ]
        },
        {
          "token": "!",
          "logprob": -5.402088165283203,
          "bytes": [
            33
          ]
        },
        {
          "token": " to",
          "logprob": -5.855781555175781,
          "bytes": [
            32,
            116,
            111
          ]
        }
      ]
    },
    {
      "token": " Good",
      "logprob": -5.263305041939961,
      "bytes": [
        32,
        71,
        111,
        111,
        100
      ],
      "top_logprobs": [
        {
          "token": "<|im_end|>",
          "logprob": -0.40727362036705017,
          "bytes": [
            60,
            124,
            105,
            109,
            95,
            101,
            110,
            100,
            124,
            62
          ]
        },
        {
          "token": " If",
          "logprob": -2.413914918899536,
          "bytes": [
            32,
            73,
            102
          ]
        },
        {
          "token": " I",
          "logprob": -2.84100079536438,
          "bytes": [
            32,
            73
          ]
        }
      ]
    },
    {
      "token": "bye",
      "logprob": -0.018060372681586653,
      "bytes": [
        98,
        121,
        101
      ],
      "top_logprobs": [
        {
          "token": "bye",
          "logprob": -0.01806037314236164,
          "bytes": [
            98,
            121,
            101
          ]
        },
        {
          "token": " day",
          "logprob": -4.528806209564209,
          "bytes": [
            32,
            100,
            97,
            121
          ]
        },
        {
          "token": " luck",
          "logprob": -6.155848979949951,
          "bytes": [
            32,
            108,
            117,
            99,
            107
          ]
        }
      ]
    },
    {
      "token": "!",
      "logprob": -0.00756201072594932,
      "bytes": [
        33
      ],
      "top_logprobs": [
        {
          "token": "!",
          "logprob": -0.007562010549008846,
          "bytes": [
            33
          ]
        },
        {
          "token": ",",
          "logprob": -5.465455532073975,
          "bytes": [
            44
          ]
        },
        {
          "token": " and",
          "logprob": -6.826884746551514,
          "bytes": [
            32,
            97,
            110,
            100
          ]
        }
      ]
    }
  ]
}
âœ… Generate API: Logprobs found in response
âœ… Generate API: Logprobs structure is correct
âœ… Generate API: Top logprobs found

ðŸ“‹ Running Generate API (without logprobs) test...
Testing Generate API without logprobs...
Request: {
  "model": "qwen2.5:0.5b",
  "prompt": "Say hello",
  "stream": false
}
Response: {
  "model": "qwen2.5:0.5b",
  "created_at": "2025-09-16T00:34:25.270536875Z",
  "response": "Hello! How can I help you today?",
  "done": true,
  "done_reason": "stop",
  "context": [
    151644,
    8948,
    198,
    2610,
    525,
    1207,
    16948,
    11,
    3465,
    553,
    54364,
    14817,
    13,
    1446,
    525,
    264,
    10950,
    17847,
    13,
    151645,
    198,
    151644,
    872,
    198,
    45764,
    23811,
    151645,
    198,
    151644,
    77091,
    198,
    9707,
    0,
    2585,
    646,
    358,
    1492,
    498,
    3351,
    30
  ],
  "total_duration": 1134426591,
  "load_duration": 71929898,
  "prompt_eval_count": 31,
  "prompt_eval_duration": 144517578,
  "eval_count": 10,
  "eval_duration": 917310259
}
âœ… Generate API: Normal response found
âœ… Generate API: No logprobs in response (as expected)

ðŸ“‹ Running Chat API (with logprobs) test...

Testing Chat API with logprobs via options...
Request: {
  "model": "qwen2.5:0.5b",
  "messages": [
    {
      "role": "user",
      "content": "Say hello"
    }
  ],
  "stream": false,
  "options": {
    "logprobs": true,
    "top_logprobs": 3
  }
}
Response: {
  "model": "qwen2.5:0.5b",
  "created_at": "2025-09-16T00:34:26.557516846Z",
  "message": {
    "role": "assistant",
    "content": "Hello! How can I help you today?",
    "logprobs": [
      {
        "token": "Hello",
        "logprob": -0.0234361093949319,
        "bytes": [
          72,
          101,
          108,
          108,
          111
        ],
        "top_logprobs": [
          {
            "token": "Hello",
            "logprob": -0.023436108604073524,
            "bytes": [
              72,
              101,
              108,
              108,
              111
            ]
          },
          {
            "token": "\u4f60\u597d",
            "logprob": -4.2192463874816895,
            "bytes": [
              228,
              189,
              160,
              229,
              165,
              189
            ]
          },
          {
            "token": "Hi",
            "logprob": -5.994608402252197,
            "bytes": [
              72,
              105
            ]
          }
        ]
      },
      {
        "token": "!",
        "logprob": -0.0165395838052924,
        "bytes": [
          33
        ],
        "top_logprobs": [
          {
            "token": "!",
            "logprob": -0.01653958298265934,
            "bytes": [
              33
            ]
          },
          {
            "token": " there",
            "logprob": -4.913653373718262,
            "bytes": [
              32,
              116,
              104,
              101,
              114,
              101
            ]
          },
          {
            "token": ",",
            "logprob": -4.928025245666504,
            "bytes": [
              44
            ]
          }
        ]
      },
      {
        "token": " How",
        "logprob": -0.37946460182201597,
        "bytes": [
          32,
          72,
          111,
          119
        ],
        "top_logprobs": [
          {
            "token": " How",
            "logprob": -0.37946459650993347,
            "bytes": [
              32,
              72,
              111,
              119
            ]
          },
          {
            "token": " It",
            "logprob": -1.4281134605407715,
            "bytes": [
              32,
              73,
              116
            ]
          },
          {
            "token": " I",
            "logprob": -3.4592013359069824,
            "bytes": [
              32,
              73
            ]
          }
        ]
      },
      {
        "token": " can",
        "logprob": -0.08392213070415744,
        "bytes": [
          32,
          99,
          97,
          110
        ],
        "top_logprobs": [
          {
            "token": " can",
            "logprob": -0.0839221328496933,
            "bytes": [
              32,
              99,
              97,
              110
            ]
          },
          {
            "token": " may",
            "logprob": -2.5336921215057373,
            "bytes": [
              32,
              109,
              97,
              121
            ]
          },
          {
            "token": " are",
            "logprob": -8.157892227172852,
            "bytes": [
              32,
              97,
              114,
              101
            ]
          }
        ]
      },
      {
        "token": " I",
        "logprob": -8.106560262170838e-05,
        "bytes": [
          32,
          73
        ],
        "top_logprobs": [
          {
            "token": " I",
            "logprob": -8.106560562737286e-05,
            "bytes": [
              32,
              73
            ]
          },
          {
            "token": " assistance",
            "logprob": -10.0459566116333,
            "bytes": [
              32,
              97,
              115,
              115,
              105,
              115,
              116,
              97,
              110,
              99,
              101
            ]
          },
          {
            "token": " ",
            "logprob": -11.515618324279785,
            "bytes": [
              32
            ]
          }
        ]
      },
      {
        "token": " help",
        "logprob": -0.8618860217506565,
        "bytes": [
          32,
          104,
          101,
          108,
          112
        ],
        "top_logprobs": [
          {
            "token": " assist",
            "logprob": -0.5538282990455627,
            "bytes": [
              32,
              97,
              115,
              115,
              105,
              115,
              116
            ]
          },
          {
            "token": " help",
            "logprob": -0.8618860244750977,
            "bytes": [
              32,
              104,
              101,
              108,
              112
            ]
          },
          {
            "token": " be",
            "logprob": -6.0449018478393555,
            "bytes": [
              32,
              98,
              101
            ]
          }
        ]
      },
      {
        "token": " you",
        "logprob": -0.00045578136185415053,
        "bytes": [
          32,
          121,
          111,
          117
        ],
        "top_logprobs": [
          {
            "token": " you",
            "logprob": -0.00045578135177493095,
            "bytes": [
              32,
              121,
              111,
              117
            ]
          },
          {
            "token": "?",
            "logprob": -8.119792938232422,
            "bytes": [
              63
            ]
          },
          {
            "token": " with",
            "logprob": -9.89405632019043,
            "bytes": [
              32,
              119,
              105,
              116,
              104
            ]
          }
        ]
      },
      {
        "token": " today",
        "logprob": -0.00453832830496936,
        "bytes": [
          32,
          116,
          111,
          100,
          97,
          121
        ],
        "top_logprobs": [
          {
            "token": " today",
            "logprob": -0.0045383283868432045,
            "bytes": [
              32,
              116,
              111,
              100,
              97,
              121
            ]
          },
          {
            "token": " with",
            "logprob": -6.204543113708496,
            "bytes": [
              32,
              119,
              105,
              116,
              104
            ]
          },
          {
            "token": "?",
            "logprob": -6.257489204406738,
            "bytes": [
              63
            ]
          }
        ]
      },
      {
        "token": "?",
        "logprob": -0.0017144467104345392,
        "bytes": [
          63
        ],
        "top_logprobs": [
          {
            "token": "?",
            "logprob": -0.0017144466983154416,
            "bytes": [
              63
            ]
          },
          {
            "token": "?\n",
            "logprob": -7.479772090911865,
            "bytes": [
              63,
              10
            ]
          },
          {
            "token": " with",
            "logprob": -7.493602275848389,
            "bytes": [
              32,
              119,
              105,
              116,
              104
            ]
          }
        ]
      }
    ]
  },
  "done_reason": "stop",
  "done": true,
  "total_duration": 1282976021,
  "load_duration": 62821857,
  "prompt_eval_count": 31,
  "prompt_eval_duration": 88822920,
  "eval_count": 10,
  "eval_duration": 1128437303
}
âœ… Chat API: Logprobs found in message
âœ… Chat API: Logprobs structure is correct
âœ… Chat API: Top logprobs found

ðŸ“‹ Running Chat API (without logprobs) test...

Testing Chat API without logprobs...
Request: {
  "model": "qwen2.5:0.5b",
  "messages": [
    {
      "role": "user",
      "content": "Say hello"
    }
  ],
  "stream": false
}
Response: {
  "model": "qwen2.5:0.5b",
  "created_at": "2025-09-16T00:34:29.077641464Z",
  "message": {
    "role": "assistant",
    "content": "Hello! How can I assist you today? Let me know if you have any questions or need help with anything else."
  },
  "done_reason": "stop",
  "done": true,
  "total_duration": 2517400635,
  "load_duration": 67458083,
  "prompt_eval_count": 31,
  "prompt_eval_duration": 89961965,
  "eval_count": 25,
  "eval_duration": 2357237616
}
âœ… Chat API: Normal message response found
âœ… Chat API: No logprobs in message (as expected)

ðŸ“‹ Running OpenAI Compatibility (with logprobs) test...

Testing OpenAI-compatible API with logprobs...
Request: {
  "model": "qwen2.5:0.5b",
  "messages": [
    {
      "role": "user",
      "content": "Say hello"
    }
  ],
  "logprobs": true,
  "top_logprobs": 3,
  "stream": false
}
Response: {
  "id": "chatcmpl-883",
  "object": "chat.completion",
  "created": 1757982870,
  "model": "qwen2.5:0.5b",
  "system_fingerprint": "fp_ollama",
  "choices": [
    {
      "index": 0,
      "message": {
        "role": "assistant",
        "content": "Hello! How can I help you today?"
      },
      "finish_reason": "stop",
      "logprobs": [
        {
          "token": "Hello",
          "logprob": -0.0234361093949319,
          "bytes": [
            72,
            101,
            108,
            108,
            111
          ],
          "top_logprobs": [
            {
              "token": "Hello",
              "logprob": -0.023436108604073524,
              "bytes": [
                72,
                101,
                108,
                108,
                111
              ]
            },
            {
              "token": "\u4f60\u597d",
              "logprob": -4.2192463874816895,
              "bytes": [
                228,
                189,
                160,
                229,
                165,
                189
              ]
            },
            {
              "token": "Hi",
              "logprob": -5.994608402252197,
              "bytes": [
                72,
                105
              ]
            }
          ]
        },
        {
          "token": "!",
          "logprob": -0.0165395838052924,
          "bytes": [
            33
          ],
          "top_logprobs": [
            {
              "token": "!",
              "logprob": -0.01653958298265934,
              "bytes": [
                33
              ]
            },
            {
              "token": " there",
              "logprob": -4.913653373718262,
              "bytes": [
                32,
                116,
                104,
                101,
                114,
                101
              ]
            },
            {
              "token": ",",
              "logprob": -4.928025245666504,
              "bytes": [
                44
              ]
            }
          ]
        },
        {
          "token": " How",
          "logprob": -0.37946460182201597,
          "bytes": [
            32,
            72,
            111,
            119
          ],
          "top_logprobs": [
            {
              "token": " How",
              "logprob": -0.37946459650993347,
              "bytes": [
                32,
                72,
                111,
                119
              ]
            },
            {
              "token": " It",
              "logprob": -1.4281134605407715,
              "bytes": [
                32,
                73,
                116
              ]
            },
            {
              "token": " I",
              "logprob": -3.4592013359069824,
              "bytes": [
                32,
                73
              ]
            }
          ]
        },
        {
          "token": " can",
          "logprob": -0.08392213070415744,
          "bytes": [
            32,
            99,
            97,
            110
          ],
          "top_logprobs": [
            {
              "token": " can",
              "logprob": -0.0839221328496933,
              "bytes": [
                32,
                99,
                97,
                110
              ]
            },
            {
              "token": " may",
              "logprob": -2.5336921215057373,
              "bytes": [
                32,
                109,
                97,
                121
              ]
            },
            {
              "token": " are",
              "logprob": -8.157892227172852,
              "bytes": [
                32,
                97,
                114,
                101
              ]
            }
          ]
        },
        {
          "token": " I",
          "logprob": -8.106560262170838e-05,
          "bytes": [
            32,
            73
          ],
          "top_logprobs": [
            {
              "token": " I",
              "logprob": -8.106560562737286e-05,
              "bytes": [
                32,
                73
              ]
            },
            {
              "token": " assistance",
              "logprob": -10.0459566116333,
              "bytes": [
                32,
                97,
                115,
                115,
                105,
                115,
                116,
                97,
                110,
                99,
                101
              ]
            },
            {
              "token": " ",
              "logprob": -11.515618324279785,
              "bytes": [
                32
              ]
            }
          ]
        },
        {
          "token": " help",
          "logprob": -0.8618860217506565,
          "bytes": [
            32,
            104,
            101,
            108,
            112
          ],
          "top_logprobs": [
            {
              "token": " assist",
              "logprob": -0.5538282990455627,
              "bytes": [
                32,
                97,
                115,
                115,
                105,
                115,
                116
              ]
            },
            {
              "token": " help",
              "logprob": -0.8618860244750977,
              "bytes": [
                32,
                104,
                101,
                108,
                112
              ]
            },
            {
              "token": " be",
              "logprob": -6.0449018478393555,
              "bytes": [
                32,
                98,
                101
              ]
            }
          ]
        },
        {
          "token": " you",
          "logprob": -0.00045578136185415053,
          "bytes": [
            32,
            121,
            111,
            117
          ],
          "top_logprobs": [
            {
              "token": " you",
              "logprob": -0.00045578135177493095,
              "bytes": [
                32,
                121,
                111,
                117
              ]
            },
            {
              "token": "?",
              "logprob": -8.119792938232422,
              "bytes": [
                63
              ]
            },
            {
              "token": " with",
              "logprob": -9.89405632019043,
              "bytes": [
                32,
                119,
                105,
                116,
                104
              ]
            }
          ]
        },
        {
          "token": " today",
          "logprob": -0.00453832830496936,
          "bytes": [
            32,
            116,
            111,
            100,
            97,
            121
          ],
          "top_logprobs": [
            {
              "token": " today",
              "logprob": -0.0045383283868432045,
              "bytes": [
                32,
                116,
                111,
                100,
                97,
                121
              ]
            },
            {
              "token": " with",
              "logprob": -6.204543113708496,
              "bytes": [
                32,
                119,
                105,
                116,
                104
              ]
            },
            {
              "token": "?",
              "logprob": -6.257489204406738,
              "bytes": [
                63
              ]
            }
          ]
        },
        {
          "token": "?",
          "logprob": -0.0017144467104345392,
          "bytes": [
            63
          ],
          "top_logprobs": [
            {
              "token": "?",
              "logprob": -0.0017144466983154416,
              "bytes": [
                63
              ]
            },
            {
              "token": "?\n",
              "logprob": -7.479772090911865,
              "bytes": [
                63,
                10
              ]
            },
            {
              "token": " with",
              "logprob": -7.493602275848389,
              "bytes": [
                32,
                119,
                105,
                116,
                104
              ]
            }
          ]
        }
      ]
    }
  ],
  "usage": {
    "prompt_tokens": 31,
    "completion_tokens": 10,
    "total_tokens": 41
  }
}
âœ… OpenAI API: Logprobs found in choice

ðŸ“‹ Running OpenAI Compatibility (without logprobs) test...

Testing OpenAI-compatible API without logprobs...
Request: {
  "model": "qwen2.5:0.5b",
  "messages": [
    {
      "role": "user",
      "content": "Say hello"
    }
  ],
  "stream": false
}
Response: {
  "id": "chatcmpl-232",
  "object": "chat.completion",
  "created": 1757982874,
  "model": "qwen2.5:0.5b",
  "system_fingerprint": "fp_ollama",
  "choices": [
    {
      "index": 0,
      "message": {
        "role": "assistant",
        "content": "Hello! How can I help you today? Let me know if there's something specific or any questions on the topic that can guide how to respond with \"Hello!\" in different contexts."
      },
      "finish_reason": "stop"
    }
  ],
  "usage": {
    "prompt_tokens": 31,
    "completion_tokens": 38,
    "total_tokens": 69
  }
}
âœ… OpenAI API: Normal message response found
âœ… OpenAI API: No logprobs in choice (as expected)

==================================================
ðŸ“Š Test Results Summary:
  Generate API (with logprobs): âœ… PASS
  Generate API (without logprobs): âœ… PASS
  Chat API (with logprobs): âœ… PASS
  Chat API (without logprobs): âœ… PASS
  OpenAI Compatibility (with logprobs): âœ… PASS
  OpenAI Compatibility (without logprobs): âœ… PASS

ðŸŽ‰ All tests passed! Logprobs implementation is working correctly.
